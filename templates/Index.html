<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <title>Email Inspector</title>
  </head>
  <body>
  <div class="app">
    <header class="topbar">
      <div class="brand">Email Inspector</div>
      <div class="top-actions">
        <a class="top-btn" href="downloadGuide.html">How to export emails</a>
      </div>
    </header>

    <main class="chat-panel">
      <div class="chat-window" id="chatWindow" role="log" aria-live="polite">
        <div class="message assistant centered">
          <div class="meta">Phishing Detector</div>
          <div>Hello, give me an email and I will parse its metadata!</div>
        </div>
      </div>

      <section class="forward-card" aria-label="Forward info">
        <div class="text">You can also forward the email to <strong>fakeemail@ncsu.edu</strong> and receive a quick reply!</div>
      </section>

      <section class="upload-card" aria-label="Upload email">
        <div class="meta">Upload email file</div>
        <div class="upload-row">
          <label class="file-chooser" for="emailFile">Choose file
            <input id="emailFile" type="file" name="emailFile" accept=".eml,.msg">
          </label>
        </div>
        <div class="hint" style="color:var(--muted);font-size:13px">Accepted: .eml, .msg â€” upload exported messages for analysis.</div>
      </section>
    </main>
  </div>

  <pre id="result"></pre>
  <script type="module">

    document.getElementById('emailFile').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const rawText = await file.text();
        sendJsonData(rawText);
    });

    function sendJsonData(metadata) {
        const dataToSend = {
            data : metadata
        };

        fetch('/submit_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dataToSend)
        })
        .then(response => response.json())
        .then(data => console.log('Server response:', data))
        .catch(error => console.error('Error:', error));
    }

  </script>
  </body>
</html>
